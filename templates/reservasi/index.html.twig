{% extends 'base.html.twig' %}

{% block title %}Reservasi - {{ hotel.namaHotel }}{% endblock %}

{% block body %}
{% include 'header.html.twig' %}

<div class="bg-slate-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

        {# Flash Messages #}
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="mb-6 bg-{{ label == 'success' ? 'green' : 'red' }}-100 border border-{{ label == 'success' ? 'green' : 'red' }}-200 text-{{ label == 'success' ? 'green' : 'red' }}-800 px-4 py-3 rounded-lg flex items-center gap-3">
                    <i class="fas fa-{{ label == 'success' ? 'check-circle' : 'exclamation-circle' }}"></i>
                    <span>{{ message }}</span>
                </div>
            {% endfor %}
        {% endfor %}

        <div class="flex flex-col lg:flex-row gap-8">
            <div class="flex-1">
                <form id="reservationForm" method="POST" class="bg-white rounded-2xl shadow-xl p-6 md:p-10">
                    <div class="text-center mb-8 pb-6 border-b border-gray-100">
                        <div class="text-4xl text-primary mb-4">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">Formulir Reservasi</h2>
                        <p class="text-gray-500 font-medium">{{ hotel.namaHotel }}</p>
                    </div>

                    <div class="space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-600 mb-2">Check-in</label>
                                <input type="date" id="checkin" name="checkin" value="{{ checkin }}" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-50 outline-none" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-600 mb-2">Check-out</label>
                                <input type="date" id="checkout" name="checkout" value="{{ checkout }}" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-50 outline-none" readonly>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-gray-600 mb-2">Tipe Kamar</label>
                                <select id="tipe_kamar" name="tipe_kamar" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary outline-none" required>
                                    {% for kamar in kamarList %}
                                        <option value="{{ kamar.id }}"
                                                data-harga="{{ kamar.harga }}"
                                                data-nama="{{ kamar.namaKamar }}"
                                                {{ kamar.id == selectedRoom.id ? 'selected' : '' }}>
                                            {{ kamar.namaKamar }} - Rp {{ kamar.harga|number_format(0, ',', '.') }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-600 mb-2">Jumlah Kamar</label>
                                <input type="number" id="jumlah_kamar" name="jumlah_kamar" value="1" min="1" max="10" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary outline-none">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full mt-10 bg-primary hover:bg-teal-700 text-white font-bold py-4 rounded-xl shadow-lg transition-all flex items-center justify-center gap-3">
                        <i class="fas fa-lock"></i> Konfirmasi Pemesanan
                    </button>
                </form>
            </div>

            <div class="lg:w-1/3">
                <div class="bg-white rounded-2xl shadow-xl p-6 sticky top-24 border border-gray-100">
                    <h4 class="text-xl font-bold text-gray-900 mb-4">Ringkasan Biaya</h4>

                    <div class="space-y-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Durasi</span>
                            <span class="font-semibold text-gray-800"><span id="display-nights">{{ nights }}</span> Malam</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Kamar</span>
                            <span id="display-room-name" class="font-semibold text-gray-800">{{ selectedRoom.namaKamar }}</span>
                        </div>

                        <div class="border-t border-dashed pt-4 mt-4">
                            <div class="flex justify-between items-center text-sm mb-2">
                                <span class="text-gray-600">Harga per Kamar</span>
                                <span id="display-price-per-room" class="text-gray-900">Rp {{ selectedRoom.harga|number_format(0, ',', '.') }}</span>
                            </div>
                            <div class="flex justify-between items-center pt-4 border-t-2 border-gray-100">
                                <span class="font-bold text-gray-800 text-lg">Total Bayar</span>
                                <span id="display-total" class="font-bold text-primary text-2xl">
                                    Rp {{ (selectedRoom.harga * nights)|number_format(0, ',', '.') }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 bg-blue-50 p-4 rounded-lg flex gap-3 items-start">
                        <i class="fas fa-info-circle text-blue-500 mt-1"></i>
                        <p class="text-[11px] text-blue-700 leading-relaxed">
                            Kalkulasi di atas sudah termasuk pajak hotel dan biaya layanan 10%.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const roomSelect = document.getElementById('tipe_kamar');
    const qtyInput = document.getElementById('jumlah_kamar');
    const nights = parseInt("{{ nights }}");

    const displayRoomName = document.getElementById('display-room-name');
    const displayPricePerRoom = document.getElementById('display-price-per-room');
    const displayTotal = document.getElementById('display-total');

    function formatRupiah(number) {
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0
        }).format(number);
    }

    function updateSummary() {
        const selectedOption = roomSelect.options[roomSelect.selectedIndex];
        const price = parseInt(selectedOption.getAttribute('data-harga'));
        const name = selectedOption.getAttribute('data-nama');
        const qty = parseInt(qtyInput.value) || 1;

        const total = price * nights * qty;

        displayRoomName.innerText = name;
        displayPricePerRoom.innerText = formatRupiah(price);
        displayTotal.innerText = formatRupiah(total);
    }

    // Jalankan update saat ada perubahan input
    roomSelect.addEventListener('change', updateSummary);
    qtyInput.addEventListener('input', updateSummary);
});
</script>

{% include 'footer.html.twig' %}
{% endblock %}
