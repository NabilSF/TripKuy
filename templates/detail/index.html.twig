{% extends 'base.html.twig' %}

{% block title %}Hello DetailController!{% endblock %}

{% block stylesheets %}
<style>
    :root{
        --primary:#2aa090;
        --secondary:#222;
        --light-gray:#F7F7F7;
        --gray:#DDD;
        --text-dark:#222;
        --text-light:#717171;
        --shadow:0 6px 16px rgba(0,0,0,0.12);
        --radius:12px;
        --transition:all 0.2s ease
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Poppins',sans-serif;color:var(--text-dark);background:#fff;line-height:1.5}
    
    .topbar {
        background:#fff;
        border-bottom:1px solid #eaeaea;
        position:fixed;
        top:0;
        left:0;
        width:100%;
        z-index:1000;
    }
    
    .topbar-container{
        max-width:1200px;
        margin:auto;
        padding:14px 24px;
        display:flex;
        align-items:center;
        justify-content:space-between
    }
    
    .logo{
        display:flex;
        align-items:center;
        gap:8px;
        font-size:20px;
        font-weight:700;
        color:var(--primary);
        text-decoration:none
    }
    
    .topbar-center{display:flex;gap:24px}
    
    .topbar-left {
        display:flex;
        align-items:center;
        gap:12px;
    }
    
    .btn-back {
        border:none;
        background:transparent;
        width:32px;
        height:32px;
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        color:#555;
        transition:background 0.2s ease, color 0.2s ease;
    }
    
    .btn-back:hover {
        background:#f2f2f2;
        color:var(--primary);
    }
    
    .btn-back i {
        font-size:14px;
    }
    
    header{
        background-color:#fff;
        box-shadow:0 2px 10px rgba(0,0,0,0.08);
        position:sticky;
        top:0;
        z-index:100;
    }
    
    .header-content{
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:15px 0;
    }
    
    .logo{
        display:flex;
        align-items:center;
        gap:12px;
    }
    
    .logo-icon{
        background-color:#2aa090;
        width:40px;
        height:40px;
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        font-size:20px;
        color:#fff
    }
    
    .logo h1{
        font-size:28px;
        font-weight:700;
        color:#222;
    }
    
    .logo span{
        color:#2aa090;
    }
    
    nav ul{
        display:flex;
        list-style:none;
        gap:25px
    }
    
    nav a{
        text-decoration:none;
        color:#666;
        font-weight:500;
        transition:color 0.3s;
        padding:5px 0;
    }
    
    nav a:hover{color:var(--primary)}
    
    .account-button{
        background-color:#fff;
        color:#666;
        border:1px solid #ddd;
        width:44px;
        height:44px;
        border-radius:50%;
        font-size:18px;
        cursor:pointer;
        transition:all 0.3s;
        display:flex;
        align-items:center;
        justify-content:center
    }
    
    .account-button:hover{
        background-color:#222;
        color:#fff;
        border-color:#222
    }
    
    .nav-item{
        font-size:14px;
        color:#555;
        text-decoration:none;
        padding:6px 0;
        position:relative;
        font-weight:500
    }
    
    .nav-item.active{
        color:var(--primary);
        font-weight:600
    }
    
    .nav-item.active::after{
        content:'';
        position:absolute;
        bottom:-6px;
        left:0;
        width:100%;
        height:2px;
        background:var(--primary);
        border-radius:2px
    }
    
    .user-avatar{
        width:36px;
        height:36px;
        border-radius:50%;
        background:#f2f2f2;
        display:flex;
        align-items:center;
        justify-content:center;
        color:#777;
        cursor:pointer
    }
    
    .hotel-container{
        max-width:1400px;
        margin:0 auto;
        padding:90px 40px 0
    }
    
    .hotel-header{
        margin-bottom:40px
    }
    
    .hotel-title{
        font-size:32px;
        font-weight:700;
        margin-bottom:10px
    }
    
    .hotel-meta{
        display:flex;
        align-items:center;
        gap:20px;
        margin-bottom:20px
    }
    
    .location{
        display:flex;
        align-items:center;
        gap:8px;
        color:var(--text-light)
    }
    
    .location i{
        color:var(--primary)
    }
    
    .hotel-description{
        color:var(--text-dark);
        font-size:16px;
        line-height:1.6;
        max-width:800px
    }
    
    .image-gallery{
        display:grid;
        grid-template-columns:2fr 1fr;
        gap:10px;
        height:600px;
        margin-bottom:40px
    }
    
    .main-image,.side-image{
        border-radius:var(--radius);
        overflow:hidden;
        position:relative
    }
    
    .main-image img,.side-image img{
        width:100%;
        height:100%;
        object-fit:cover
    }
    
    .side-images{
        display:grid;
        grid-template-rows:1fr 1fr;
        gap:10px
    }
    
    .view-more{
        position:absolute;
        bottom:15px;
        right:15px;
        background:rgba(0,0,0,0.7);
        color:#fff;
        padding:8px 16px;
        border-radius:20px;
        font-size:14px;
        text-decoration:none
    }
    
    .booking-widget{
        position:sticky;
        top:100px;
        background:#fff;
        border:1px solid var(--gray);
        border-radius:var(--radius);
        padding:25px;
        box-shadow:var(--shadow);
        margin-bottom:40px
    }
    
    .price-amount{
        font-size:28px;
        font-weight:700;
        color:var(--primary);
        margin-bottom:5px
    }
    
    .booking-dates{
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:15px;
        margin:20px 0
    }
    
    .date-input{
        padding:12px;
        border:1px solid var(--gray);
        border-radius:8px;
        font-size:14px;
        width:100%
    }
    
    .date-input:focus{
        outline:none;
        border-color:var(--primary)
    }
    
    .book-now-btn{
        width:100%;
        padding:16px;
        background:linear-gradient(135deg,#2aa090,#41b6a6);
        color:#fff;
        border:none;
        border-radius:8px;
        font-size:16px;
        font-weight:600;
        cursor:pointer;
        transition:var(--transition)
    }
    
    .book-now-btn:hover{
        transform:translateY(-2px);
        box-shadow:0 6px 20px rgba(42,160,144,0.3);
        background:linear-gradient(135deg,#249283,#3aa597)
    }
    
    .rooms-section{
        margin-bottom:60px
    }
    
    .section-title{
        font-size:24px;
        font-weight:700;
        margin-bottom:30px;
        color:var(--text-dark)
    }
    
    .room-card{
        background:#fff;
        border:1px solid var(--gray);
        border-radius:var(--radius);
        padding:25px;
        margin-bottom:25px;
        display:flex;
        gap:25px;
        transition:var(--transition)
    }
    
    .room-card:hover{
        box-shadow:var(--shadow)
    }
    
    .room-image{
        flex:0 0 300px;
        border-radius:var(--radius);
        overflow:hidden
    }
    
    .room-image img{
        width:100%;
        height:200px;
        object-fit:cover
    }
    
    .room-content{
        flex:1
    }
    
    .room-header{
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        margin-bottom:15px
    }
    
    .room-title{
        font-size:20px;
        font-weight:700;
        margin-bottom:5px
    }
    
    .room-price{
        text-align:right
    }
    
    .price-night{
        font-size:24px;
        font-weight:700;
        color:var(--primary)
    }
    
    .room-actions{
        display:flex;
        justify-content:space-between;
        align-items:center;
        margin-top:20px;
        padding-top:20px;
        border-top:1px solid var(--gray)
    }
    
    .book-room-btn{
        padding:12px 24px;
        background:var(--primary);
        color:#fff;
        border:none;
        border-radius:8px;
        font-weight:600;
        cursor:pointer;
        transition:var(--transition)
    }
    
    .book-room-btn:hover{
        background:#249283
    }
    
    .reviews-section{
        margin-bottom:60px
    }
    
    .review-card{
        background:#fff;
        border:1px solid var(--gray);
        border-radius:var(--radius);
        padding:25px;
        margin-bottom:20px
    }
    
    .review-header{
        display:flex;
        align-items:center;
        gap:15px;
        margin-bottom:15px
    }
    
    .review-avatar{
        width:50px;
        height:50px;
        border-radius:50%;
        background:var(--light-gray);
        display:flex;
        align-items:center;
        justify-content:center;
        font-weight:700;
        color:var(--primary)
    }
    
    .review-rating{
        display:flex;
        align-items:center;
        gap:5px;
        color:#FFB700
    }
    
    footer{
        background:var(--light-gray);
        padding:40px;
        margin-top:60px;
        border-top:1px solid var(--gray)
    }
    
    .footer-content{
        max-width:1400px;
        margin:0 auto;
        display:grid;
        grid-template-columns:repeat(4,1fr);
        gap:40px
    }
    
    .footer-section h3{
        font-size:16px;
        margin-bottom:20px;
        color:var(--text-dark)
    }
    
    .footer-section ul{
        list-style:none
    }
    
    .footer-section ul li{
        margin-bottom:12px
    }
    
    .footer-section ul li a{
        text-decoration:none;
        color:var(--text-light);
        font-size:14px;
        transition:var(--transition)
    }
    
    .footer-section ul li a:hover{
        color:var(--primary)
    }
    
    .copyright{
        text-align:center;
        padding:20px;
        color:var(--text-light);
        font-size:14px;
        border-top:1px solid var(--gray);
        margin-top:40px
    }
    
    @media (max-width:992px){
        .hotel-container{padding:20px}
        .image-gallery{height:300px}
        .room-card{flex-direction:column}
        .room-image{flex:none;width:100%}
        .footer-content{grid-template-columns:repeat(2,1fr)}
    }
    
    @media (max-width:768px){
        .hotel-container{padding:20px}
        .hotel-title{font-size:24px}
        .image-gallery{grid-template-columns:1fr;height:auto}
        .side-images{grid-template-columns:1fr 1fr;grid-template-rows:auto}
        .booking-dates{grid-template-columns:1fr}
        .room-header{flex-direction:column;gap:15px}
        .room-price{text-align:left}
        .footer-content{grid-template-columns:1fr}
    }
    
    @media (max-width:576px){
        .hotel-title{font-size:22px}
        .section-title{font-size:20px}
        .price-amount{font-size:24px}
        .price-night{font-size:20px}
    }
    </style>
{% endblock %}

{% block body %}
<header>
  <div class="container">
    <div class="header-content">

      <!-- Logo -->
      <div class="logo">
        <div class="logo-icon"><i class="fas fa-suitcase-rolling"></i></div>
        <h1>Trip<span>Kuy</span></h1>
      </div>

      <!-- Navigasi -->

      <!-- Tombol akun -->
      <button class="account-button" id="accountButton">
        <i class="fas fa-user"></i>
      </button>

    </div>
  </div>
</header>

<div class="hotel-container">
    <div class="hotel-header">
        <h1 class="hotel-title"><?= htmlspecialchars($hotel['nama_hotel']) ?></h1>
        <div class="hotel-meta">
            <div class="location">
                <i class="fas fa-map-marker-alt"></i>
                <?= htmlspecialchars($hotel['alamat']) ?>
            </div>
        </div>
        <p class="hotel-description"><?= htmlspecialchars($hotel['deskripsi']) ?></p>
    </div>
    
    <div class="image-gallery">
        <div class="main-image">
            <img src="<?= htmlspecialchars($main_image) ?>" alt="<?= htmlspecialchars($hotel['nama_hotel']) ?>">
        </div>
        <div class="side-images">
            <?php for ($i = 0; $i < 2; $i++): ?>
            <div class="side-image">
                <img src="<?= htmlspecialchars($main_image) ?>" alt="Gambar <?= $i+1 ?> - <?= htmlspecialchars($hotel['nama_hotel']) ?>">
                <?php if ($i == 1): ?>
                <a href="#" class="view-more">+5 foto</a>
                <?php endif; ?>
            </div>
            <?php endfor; ?>
        </div>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 350px;gap:40px">
        <div>
            <div class="rooms-section">
                <h2 class="section-title">Tipe Kamar</h2>
                
                <?php if (!empty($kamar_data_all)): ?>
                    <?php foreach ($kamar_data_all as $kamar): 
                        $total_price = $kamar['harga'] * $nights;
                        $room_image = !empty($kamar['gambar']) ? $kamar['gambar'] : 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?auto=format&fit=crop&w=800&q=80';
                    ?>
                    <div class="room-card">
                        <div class="room-image">
                            <img src="<?= htmlspecialchars($room_image) ?>" alt="<?= htmlspecialchars($kamar['nama_kamar']) ?>">
                        </div>
                        <div class="room-content">
                            <div class="room-header">
                                <div>
                                    <h3 class="room-title"><?= htmlspecialchars($kamar['nama_kamar']) ?></h3>
                                    <div style="color:var(--text-light);font-size:14px;margin-bottom:15px">
                                        <i class="fas fa-user"></i> Maks <?= $kamar['kapasitas_orang'] ?> orang
                                    </div>
                                </div>
                                <div class="room-price">
                                    <div class="price-night">Rp <?= number_format($kamar['harga'],0,',','.') ?>/malam</div>
                                    <div style="font-size:14px;color:var(--text-light)">
                                        Rp <?= number_format($total_price,0,',','.') ?> untuk <?= $nights ?> malam
                                    </div>
                                </div>
                            </div>
                            <p style="margin-bottom:15px"><?= htmlspecialchars($kamar['deskripsi']) ?></p>
                            <div class="room-actions">
                                <div style="font-size:14px;color:var(--text-light)">
                                    <i class="fas fa-bed"></i> Tersedia <?= $kamar['total_kamar'] ?> kamar
                                </div>
                                <button class="book-room-btn" onclick="bookRoom(<?= $kamar['id_kamar'] ?>)">
                                    Pilih Kamar
                                </button>
                            </div>
                        </div>
                    </div>
                    <?php endforeach; ?>
                <?php else: ?>
                    <p style="color:var(--text-light);text-align:center;padding:40px">
                        Belum ada kamar tersedia di hotel ini.
                    </p>
                <?php endif; ?>
            </div>
            
            <?php if (mysqli_num_rows($review_result) > 0): ?>
            <div class="reviews-section">
                <h2 class="section-title">Ulasan Tamu</h2>
                <?php while ($review = mysqli_fetch_assoc($review_result)): ?>
                <div class="review-card">
                    <div class="review-header">
                        <div class="review-avatar">
                            <?= strtoupper(substr($review['nama'],0,1)) ?>
                        </div>
                        <div>
                            <div style="font-weight:600"><?= htmlspecialchars($review['nama']) ?></div>
                            <div class="review-rating">
                                <?php for ($i = 1; $i <= 5; $i++): ?>
                                    <?php if ($i <= $review['rating']): ?>
                                        <i class="fas fa-star"></i>
                                    <?php else: ?>
                                        <i class="far fa-star"></i>
                                    <?php endif; ?>
                                <?php endfor; ?>
                                <span style="margin-left:5px;color:var(--text-light)">
                                    <?= date('d M Y') ?>
                                </span>
                            </div>
                        </div>
                    </div>
                    <p><?= htmlspecialchars($review['deskripsi']) ?></p>
                </div>
                <?php endwhile; ?>
            </div>
            <?php endif; ?>
        </div>
        
        <div>
            <div class="booking-widget">
                <div style="margin-bottom:20px">
                    <!-- FIX: Tampilkan harga dengan benar -->
                    <div class="price-amount">
                        Rp <?= $first_room ? number_format($first_room['harga'],0,',','.') : number_format($default_price,0,',','.') ?>
                    </div>
                    <div style="font-size:14px;color:var(--text-light)">
                        per malam Â· Termasuk pajak
                    </div>
                </div>
                
                <!-- FIX: Form dengan method GET -->
                <form id="bookingForm" method="GET" action="reservation.php">
                    <!-- FIX: Gunakan name="id" bukan hidden input -->
                    <input type="hidden" name="id" value="<?= $id_hotel ?>">
                    
                    <div class="booking-dates">
                        <div>
                            <div style="font-size:12px;margin-bottom:5px;font-weight:600">CHECK-IN</div>
                            <input type="date" name="checkin" value="<?= htmlspecialchars($checkin) ?>" class="date-input" min="<?= date('Y-m-d') ?>" required>
                        </div>
                        <div>
                            <div style="font-size:12px;margin-bottom:5px;font-weight:600">CHECK-OUT</div>
                            <input type="date" name="checkout" value="<?= htmlspecialchars($checkout) ?>" class="date-input" min="<?= date('Y-m-d', strtotime('+1 day')) ?>" required>
                        </div>
                    </div>
                    <button type="submit" class="book-now-btn">
                        <i class="fas fa-calendar-check"></i> Pesan Sekarang
                    </button>
                </form>
                
                <div style="text-align:center;margin-top:20px;color:var(--text-light);font-size:12px">
                    <i class="fas fa-shield-alt"></i> Pembatalan gratis hingga 48 jam sebelum check-in
                </div>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="footer-content">
        <div class="footer-section">
            <h3>TripKuy</h3>
            <ul>
                <li><a href="#">Tentang Kami</a></li>
                <li><a href="#">Karir</a></li>
                <li><a href="#">Blog</a></li>
                <li><a href="#">Pusat Bantuan</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h3>Destinasi</h3>
            <ul>
                <li><a href="#">Jakarta</a></li>
                <li><a href="#">Bali</a></li>
                <li><a href="#">Bandung</a></li>
                <li><a href="#">Yogyakarta</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h3>Partner</h3>
            <ul>
                <li><a href="#">Jadi Partner</a></li>
                <li><a href="#">Program Afiliasi</a></li>
                <li><a href="#">Travel Agent</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h3>Lainnya</h3>
            <ul>
                <li><a href="#">Syarat & Ketentuan</a></li>
                <li><a href="#">Kebijakan Privasi</a></li>
                <li><a href="#">Peta Situs</a></li>
            </ul>
        </div>
    </div>
    <div class="copyright">&copy; 2024 TripKuy. All rights reserved.</div>
</footer>
{% endblock %}

{% block javascripts %}
<script>
const today = new Date().toISOString().split('T')[0];
const tomorrow = new Date();
tomorrow.setDate(tomorrow.getDate() + 1);
const tomorrowStr = tomorrow.toISOString().split('T')[0];
const checkinInput = document.querySelector('input[name="checkin"]');
const checkoutInput = document.querySelector('input[name="checkout"]');

checkinInput.min = today;
checkoutInput.min = tomorrowStr;

checkinInput.addEventListener('change', function() {
    const selectedDate = new Date(this.value);
    const nextDay = new Date(selectedDate);
    nextDay.setDate(nextDay.getDate() + 1);
    checkoutInput.min = nextDay.toISOString().split('T')[0];
    
    const checkoutDate = new Date(checkoutInput.value);
    if (checkoutDate <= selectedDate) {
        checkoutInput.value = nextDay.toISOString().split('T')[0];
    }
    updateURL();
});

checkoutInput.addEventListener('change', function() {
    updateURL();
});

function updateURL() {
    const checkin = checkinInput.value;
    const checkout = checkoutInput.value;
    if (checkin && checkout) {
        const currentURL = new URL(window.location.href);
        currentURL.searchParams.set('checkin', checkin);
        currentURL.searchParams.set('checkout', checkout);
        window.location.href = currentURL.toString();
    }
}

function bookRoom(roomId) {
    const checkin = checkinInput.value;
    const checkout = checkoutInput.value;
    if (!checkin || !checkout) {
        alert('Silakan pilih tanggal check-in dan check-out terlebih dahulu');
        return;
    }
    window.location.href = `reservation.php?id=<?= $id_hotel ?>&checkin=${checkin}&checkout=${checkout}&room_id=${roomId}`;
}

document.getElementById('bookingForm').addEventListener('submit', function(e) {
    const checkin = checkinInput.value;
    const checkout = checkoutInput.value;
    if (!checkin || !checkout) {
        e.preventDefault();
        alert('Silakan pilih tanggal check-in dan check-out');
        return;
    }
    
    const checkinDate = new Date(checkin);
    const checkoutDate = new Date(checkout);
    if (checkoutDate <= checkinDate) {
        e.preventDefault();
        alert('Tanggal check-out harus setelah tanggal check-in');
        return;
    }
});
</script>
{% endblock %}